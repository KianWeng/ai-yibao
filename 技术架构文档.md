# 智慧医康保险服务平台 - 技术架构文档

## 一、项目概述

智慧医康保险服务平台是一个完整的前后端分离的Web应用系统，实现了医康保险相关的核心业务功能，包括数据概览、DRG支付政策管理、康复服务衔接、风控与预测、AI智能助手等模块。

### 1.1 项目特点
- **前后端分离架构**：前端使用Vue 3，后端使用Node.js + Express
- **单页面应用（SPA）**：无需刷新页面，流畅的用户体验
- **RESTful API设计**：标准化的API接口设计
- **数据可视化**：丰富的图表展示，直观的数据分析
- **AI智能助手**：集成大模型API，提供智能问答和分析功能
- **角色权限管理**：支持管理员和普通用户两种角色

---

## 二、技术架构

### 2.1 整体架构图

```
┌─────────────────────────────────────────────────────────┐
│                      前端层 (Frontend)                    │
├─────────────────────────────────────────────────────────┤
│  Vue 3 + Element Plus + ECharts + Tailwind CSS          │
│  - 单页面应用 (SPA)                                      │
│  - 组件化开发                                            │
│  - 响应式设计                                            │
└──────────────────┬──────────────────────────────────────┘
                   │ HTTP/HTTPS
                   │ RESTful API
┌──────────────────▼──────────────────────────────────────┐
│                   后端层 (Backend)                        │
├─────────────────────────────────────────────────────────┤
│  Node.js + Express.js                                    │
│  - RESTful API服务                                       │
│  - JWT身份认证                                           │
│  - 路由模块化                                             │
└──────────────────┬──────────────────────────────────────┘
                   │
┌──────────────────▼──────────────────────────────────────┐
│                   数据层 (Data Layer)                     │
├─────────────────────────────────────────────────────────┤
│  SQLite3 数据库                                           │
│  - 8个核心数据表                                         │
│  - 自动初始化                                             │
│  - 数据迁移支持                                           │
└──────────────────┬──────────────────────────────────────┘
                   │
┌──────────────────▼──────────────────────────────────────┐
│                 外部服务 (External Services)              │
├─────────────────────────────────────────────────────────┤
│  AI大模型API (可选)                                       │
│  - OpenAI API / 其他大模型API                            │
│  - 医保欺诈检测分析                                       │
│  - 转院建议服务                                           │
└─────────────────────────────────────────────────────────┘
```

### 2.2 前端技术栈

#### 核心框架
- **Vue 3.3.4**：渐进式JavaScript框架，使用Composition API
  - 响应式数据绑定
  - 组件化开发
  - 生命周期管理

#### UI组件库
- **Element Plus 2.3.9**：基于Vue 3的企业级UI组件库
  - 表格、表单、对话框等组件
  - 消息提示、确认框等交互组件
  - 日期选择器、分页器等功能组件

#### 数据可视化
- **ECharts 5.4.3**：强大的数据可视化库
  - 折线图、柱状图、饼图等
  - 支持交互式图表
  - 响应式布局

#### 样式框架
- **Tailwind CSS**：实用优先的CSS框架
  - 原子化CSS类
  - 响应式设计
  - 自定义主题配置

#### 图标库
- **Font Awesome 4.7.0**：丰富的图标库

#### 依赖加载方式
- 所有前端依赖通过CDN加载，无需构建工具
- 适合快速开发和部署

### 2.3 后端技术栈

#### 运行环境
- **Node.js**：JavaScript运行时环境

#### Web框架
- **Express.js 4.18.2**：快速、极简的Web框架
  - 路由管理
  - 中间件支持
  - RESTful API设计

#### 数据库
- **SQLite3 5.1.6**：轻量级嵌入式数据库
  - 文件型数据库，无需单独服务
  - 支持SQL标准
  - 自动初始化表结构

#### 身份认证
- **jsonwebtoken 9.0.3**：JWT令牌生成和验证
  - 无状态认证
  - Token过期管理
  - 用户信息加密存储

#### 密码加密
- **bcryptjs 2.4.3**：密码哈希加密
  - 安全的密码存储
  - 盐值自动生成

#### HTTP客户端
- **axios 1.13.2**：Promise based HTTP客户端
  - 用于调用外部AI API
  - 请求/响应拦截
  - 错误处理

#### 工具库
- **uuid 9.0.1**：唯一标识符生成
- **body-parser 1.20.2**：请求体解析
- **cors 2.8.5**：跨域资源共享

---

## 三、系统架构设计

### 3.1 前后端分离架构

#### 前端架构
```
前端应用 (index.html)
├── 静态资源
│   ├── HTML结构
│   ├── CSS样式 (Tailwind CSS)
│   └── JavaScript逻辑 (Vue 3)
├── 组件结构
│   ├── 顶部导航栏
│   ├── 侧边栏菜单
│   ├── 主内容区
│   └── AI助手面板
└── 功能模块
    ├── 数据概览
    ├── DRG支付政策
    ├── 康复服务衔接
    ├── 风控与预测
    └── 用户管理
```

#### 后端架构
```
后端服务 (server.js)
├── 中间件层
│   ├── CORS跨域处理
│   ├── Body解析
│   └── 错误处理
├── 路由层 (routes/)
│   ├── auth.js - 用户认证
│   ├── dashboard.js - 数据概览
│   ├── drg.js - DRG管理
│   ├── rehabilitation.js - 康复服务
│   ├── risk.js - 风控管理
│   ├── transfer.js - 转院申请
│   ├── user.js - 用户管理
│   └── ai-assistant.js - AI助手
├── 数据访问层 (db.js)
│   ├── 数据库连接
│   ├── 表结构初始化
│   ├── 数据迁移
│   └── CRUD操作封装
└── 数据库 (database.sqlite)
    └── 8个核心数据表
```

### 3.2 API设计规范

#### RESTful API设计原则
- 使用标准HTTP方法：GET、POST、PUT、DELETE
- 统一的响应格式：
```json
{
  "code": 200,
  "message": "操作成功",
  "data": {}
}
```

#### API路由结构
```
/api/auth/*          - 用户认证相关
/api/dashboard/*     - 数据概览相关
/api/drg/*           - DRG支付政策相关
/api/rehabilitation/* - 康复服务相关
/api/risk/*          - 风控管理相关
/api/transfer/*      - 转院申请相关
/api/user/*          - 用户管理相关
/api/ai-assistant/*  - AI助手相关
```

### 3.3 数据流设计

#### 用户请求流程
```
用户操作
  ↓
前端Vue组件
  ↓
API请求 (fetch/axios)
  ↓
后端Express路由
  ↓
业务逻辑处理
  ↓
数据库操作 (SQLite)
  ↓
返回响应数据
  ↓
前端更新UI
```

#### 认证流程
```
用户登录
  ↓
验证用户名密码
  ↓
生成JWT Token
  ↓
返回Token给前端
  ↓
前端存储Token (localStorage)
  ↓
后续请求携带Token
  ↓
后端验证Token
  ↓
允许/拒绝访问
```

---

## 四、数据库设计

### 4.1 数据库选型
- **数据库类型**：SQLite3
- **存储方式**：文件型数据库（database.sqlite）
- **特点**：
  - 轻量级，无需单独服务
  - 适合中小型应用
  - 支持SQL标准
  - 自动初始化表结构

### 4.2 数据表结构

#### 1. users - 用户表
```sql
CREATE TABLE users (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  username TEXT UNIQUE NOT NULL,
  password TEXT NOT NULL,
  real_name TEXT,
  phone TEXT,
  id_card TEXT,
  role TEXT DEFAULT 'user',  -- 'admin' | 'user'
  status INTEGER DEFAULT 1,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

#### 2. drg_policies - DRG支付政策表
```sql
CREATE TABLE drg_policies (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  drg_code TEXT NOT NULL,
  drg_name TEXT NOT NULL,
  diagnosis TEXT,
  payment_standard REAL,
  effective_date TEXT,
  status INTEGER DEFAULT 1,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

#### 3. rehabilitation_institutions - 康复机构表
```sql
CREATE TABLE rehabilitation_institutions (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  name TEXT NOT NULL,
  level TEXT,
  bed_count INTEGER,
  specialty TEXT,
  status TEXT DEFAULT '营业中',
  rating REAL DEFAULT 0,
  price_level TEXT DEFAULT '中等',
  address TEXT,
  phone TEXT,
  description TEXT,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

#### 4. transfer_applications - 转院申请表
```sql
CREATE TABLE transfer_applications (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  apply_no TEXT UNIQUE NOT NULL,
  user_id INTEGER,
  patient_name TEXT NOT NULL,
  patient_id_card TEXT,
  patient_phone TEXT,
  from_hospital TEXT,
  to_hospital TEXT,
  to_hospital_id INTEGER,
  disease TEXT,
  disease_description TEXT,
  reason TEXT,
  expected_cost REAL,
  status TEXT DEFAULT 'pending',  -- 'pending' | 'approved' | 'rejected'
  admin_comment TEXT,
  apply_time DATETIME DEFAULT CURRENT_TIMESTAMP,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

#### 5. risk_events - 风险事件表
```sql
CREATE TABLE risk_events (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  event_id TEXT UNIQUE NOT NULL,
  patient_name TEXT,
  hospital TEXT,
  risk_type TEXT,
  risk_level TEXT,  -- '高' | '中' | '低'
  handle_status TEXT DEFAULT '待处理',
  event_time DATETIME DEFAULT CURRENT_TIMESTAMP,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

#### 6. warnings - 预警表
```sql
CREATE TABLE warnings (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  warning_id TEXT UNIQUE NOT NULL,
  hospital TEXT,
  type TEXT,
  amount REAL,
  status TEXT DEFAULT '待处理',
  warning_time DATETIME DEFAULT CURRENT_TIMESTAMP,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

#### 7. hospitals - 医院信息表
```sql
CREATE TABLE hospitals (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  name TEXT NOT NULL,
  level TEXT,
  address TEXT,
  phone TEXT,
  specialty TEXT,
  description TEXT,
  average_cost REAL,
  rating REAL DEFAULT 0,
  rating_count INTEGER DEFAULT 0,
  bed_count INTEGER,
  status TEXT DEFAULT '营业中',
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

#### 8. hospital_reviews - 医院评价表
```sql
CREATE TABLE hospital_reviews (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  hospital_id INTEGER NOT NULL,
  user_id INTEGER,
  rating INTEGER DEFAULT 5,
  comment TEXT,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (hospital_id) REFERENCES hospitals(id),
  FOREIGN KEY (user_id) REFERENCES users(id)
);
```

### 4.3 数据库初始化
- **自动创建表结构**：首次启动时自动创建所有表
- **数据迁移支持**：支持字段添加和表结构升级
- **初始数据插入**：自动插入示例数据（如果表为空）

---

## 五、核心功能模块

### 5.1 用户认证模块 (auth.js)

#### 功能
- 用户注册
- 用户登录
- 用户登出
- Token验证
- 用户信息获取

#### 技术实现
- JWT Token认证
- bcryptjs密码加密
- 默认用户初始化（admin/admin123, user/user123）

### 5.2 数据概览模块 (dashboard.js)

#### 功能
- 核心指标展示（支付效率、康复衔接效率、赔付率、结算时间）
- 医保费用趋势图表（月度/季度/年度）
- 风控预警分布
- 最近预警列表

#### 技术实现
- ECharts图表渲染
- 数据统计和聚合
- 实时数据刷新

### 5.3 DRG支付政策模块 (drg.js)

#### 功能
- DRG政策列表（分页、搜索、筛选）
- DRG政策新增/编辑/删除
- DRG分组统计图表

#### 技术实现
- CRUD操作
- 分页查询
- 数据验证

### 5.4 康复服务衔接模块 (rehabilitation.js)

#### 功能
- 康复机构管理（列表、详情、新增、编辑）
- 转院申请管理（列表、审批、拒绝）
- 转院申请统计（今日/本周/本月）
- 申请状态分布图表

#### 技术实现
- 复杂表单处理
- 状态流转管理
- 统计数据计算

### 5.5 风控与预测模块 (risk.js)

#### 功能
- 风控模型概览（召回率、误报率、拦截成功率）
- 风险类型分布图表
- 风险等级分布图表
- 风险事件列表（搜索、筛选）

#### 技术实现
- 数据统计分析
- 多维度图表展示

### 5.6 AI助手模块 (ai-assistant.js)

#### 功能
- 智能问答（医保欺诈检测、转院建议）
- 数据分析
- 上下文感知

#### 技术实现
- 集成大模型API（OpenAI等）
- 系统提示词定制
- 模拟响应（开发模式）
- 角色区分（管理员/普通用户）

---

## 六、安全设计

### 6.1 身份认证
- **JWT Token**：无状态认证机制
- **Token过期**：24小时有效期
- **密码加密**：bcryptjs哈希加密，盐值自动生成

### 6.2 权限控制
- **角色区分**：管理员（admin）和普通用户（user）
- **前端路由守卫**：未登录自动跳转登录页
- **后端Token验证**：API请求验证Token有效性

### 6.3 数据安全
- **SQL注入防护**：使用参数化查询
- **CORS配置**：限制允许的源
- **输入验证**：前后端双重验证

---

## 七、部署架构

### 7.1 开发环境
```
前端：直接打开 index.html 或使用本地HTTP服务器
后端：Node.js + Express，端口 3000
数据库：SQLite文件数据库
```

### 7.2 生产环境建议
```
前端：
  - 静态文件服务器（Nginx/Apache）
  - CDN加速
  - 浏览器缓存

后端：
  - Node.js进程管理（PM2）
  - 反向代理（Nginx）
  - 负载均衡（可选）

数据库：
  - SQLite（小规模）
  - PostgreSQL/MySQL（大规模，需迁移）
```

### 7.3 启动脚本
- **start.sh**：自动化启动脚本
  - 检查Node.js和npm
  - 安装依赖
  - 启动后端服务

---

## 八、技术亮点

### 8.1 前端亮点
1. **单页面应用**：无需刷新，流畅体验
2. **组件化开发**：Vue 3 Composition API，代码复用性高
3. **响应式设计**：Tailwind CSS，适配不同屏幕
4. **数据可视化**：ECharts丰富的图表展示
5. **CDN加载**：无需构建工具，快速部署

### 8.2 后端亮点
1. **RESTful API**：标准化接口设计
2. **模块化路由**：功能模块独立，易于维护
3. **数据库自动初始化**：首次启动自动创建表结构
4. **数据迁移支持**：支持表结构升级
5. **JWT认证**：无状态认证，易于扩展

### 8.3 系统亮点
1. **AI智能助手**：集成大模型，提供智能分析
2. **角色权限管理**：管理员和普通用户区分
3. **实时数据更新**：支持数据刷新和实时同步
4. **错误处理**：完善的错误提示和异常处理

---

## 九、技术栈总结

### 前端技术栈
| 技术 | 版本 | 用途 |
|------|------|------|
| Vue | 3.3.4 | 前端框架 |
| Element Plus | 2.3.9 | UI组件库 |
| ECharts | 5.4.3 | 数据可视化 |
| Tailwind CSS | - | CSS框架 |
| Font Awesome | 4.7.0 | 图标库 |

### 后端技术栈
| 技术 | 版本 | 用途 |
|------|------|------|
| Node.js | - | 运行环境 |
| Express | 4.18.2 | Web框架 |
| SQLite3 | 5.1.6 | 数据库 |
| jsonwebtoken | 9.0.3 | JWT认证 |
| bcryptjs | 2.4.3 | 密码加密 |
| axios | 1.13.2 | HTTP客户端 |

---

## 十、项目结构

```
ai-yibao/
├── index.html              # 前端主页面（管理员）
├── login.html              # 登录页面
├── register.html           # 注册页面
├── user.html               # 用户页面（普通用户）
├── start.sh                # 启动脚本
├── README.md               # 项目说明
├── QUICKSTART.md           # 快速开始指南
├── PROJECT_SUMMARY.md      # 项目总结
├── 技术架构文档.md         # 本文档
└── backend/                # 后端服务
    ├── server.js           # 服务器入口
    ├── db.js               # 数据库操作
    ├── package.json        # 依赖配置
    ├── database.sqlite     # 数据库文件（自动生成）
    └── routes/             # 路由文件
        ├── auth.js         # 用户认证
        ├── dashboard.js    # 数据概览
        ├── drg.js          # DRG管理
        ├── rehabilitation.js # 康复服务
        ├── risk.js         # 风控管理
        ├── transfer.js     # 转院申请
        ├── user.js         # 用户管理
        └── ai-assistant.js # AI助手
```

---

## 十一、扩展建议

### 11.1 性能优化
1. **前端优化**
   - 代码分割和懒加载
   - 图片优化和CDN
   - 浏览器缓存策略

2. **后端优化**
   - 数据库索引优化
   - API响应缓存
   - 连接池管理

### 11.2 功能扩展
1. **数据导出**：Excel/PDF导出功能
2. **消息通知**：实时消息推送
3. **日志系统**：操作日志记录
4. **数据备份**：定期数据备份
5. **单元测试**：添加测试用例

### 11.3 技术升级
1. **数据库迁移**：从SQLite迁移到PostgreSQL/MySQL
2. **构建工具**：引入Vite/Webpack进行前端构建
3. **TypeScript**：引入类型检查
4. **微服务架构**：拆分服务模块

---

## 十二、总结

智慧医康保险服务平台采用现代化的前后端分离架构，使用Vue 3 + Node.js + Express + SQLite技术栈，实现了完整的业务功能。系统具有以下特点：

1. **技术先进**：使用最新的前端框架和工具
2. **架构清晰**：前后端分离，模块化设计
3. **易于维护**：代码结构清晰，注释完善
4. **功能完整**：涵盖核心业务功能
5. **扩展性强**：支持功能扩展和技术升级

该平台适合作为医康保险领域的原型系统，可以根据实际需求进行功能扩展和优化。

---

**文档版本**：v1.0  
**最后更新**：2025年1月  
**维护者**：开发团队

